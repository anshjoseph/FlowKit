2025-10-14 22:26:42.809 INFO {MainThread} [main] (<module>) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:105} Starting FastAPI app at 0.0.0.0:9500
2025-10-14 22:26:42.859 INFO {MainThread} [main] (lifespan) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:35} Starting FlowKit Control Unit lifespan
2025-10-14 22:26:42.893 INFO {MainThread} [fcb_queue] (__init__) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:23} Initialized FlowControlBlockQueue with MongoDB connection
2025-10-14 22:26:42.893 INFO {MainThread} [fcb_queue] (recover_from_storage) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:27} Starting recovery of FlowControlBlocks from MongoDB
2025-10-14 22:26:42.923 INFO {MainThread} [main] (lifespan) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:39} Recovered FCB_QUEUE from storage
2025-10-14 22:26:45.630 INFO {MainThread} [main] (log_requests) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:48} Incoming request: POST http://127.0.0.1:9500/fcb/add
2025-10-14 22:26:45.632 INFO {MainThread} [main] (add_fcb) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:60} Add FCB request received with nodes: ['start', 'node1']
2025-10-14 22:26:45.632 INFO {MainThread} [flow] (__init__) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow.py:12} Flow initialized with 2 nodes
2025-10-14 22:26:45.632 INFO {MainThread} [flow_control_block] (__init__) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:27} FlowControlBlock 670dbfc1-653a-4f18-98d5-842df98f3eda initialized in QUEUED state
2025-10-14 22:26:45.632 INFO {MainThread} [fcb_queue] (add_fcb) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:107} \u2795 Added new FlowControlBlock with id 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:45.632 INFO {MainThread} [flow_control_block] (start) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:30} FlowControlBlock 670dbfc1-653a-4f18-98d5-842df98f3eda starting
2025-10-14 22:26:45.632 INFO {MainThread} [flow_control_block] (exec) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:72} Submitting next node execution for flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:45.633 INFO {ThreadPoolExecutor-1_0} [flow] (get_curr_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow.py:24} Getting current node: start
2025-10-14 22:26:45.634 INFO {ThreadPoolExecutor-1_0} [flow] (get_curr_inp) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow.py:28} Getting current input data: {}
2025-10-14 22:26:45.634 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (_run_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:57} Executing node 'start' in flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:45.634 INFO {ThreadPoolExecutor-1_0} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:55} Executing node 'start' [runner_id=7ccbb49a-87a2-4873-b1a8-d48c4aee3f29] with inputs: {}
2025-10-14 22:26:45.634 INFO {ThreadPoolExecutor-1_0} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:58} Sending POST to http://127.0.0.1:8500/nodes/add-node with payload keys: ['node_name', 'code', 'inputs', 'runner_id']
2025-10-14 22:26:45.633 INFO {MainThread} [fcb_queue] (start_fcb) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:115} \u25b6\ufe0f Started FlowControlBlock 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:45.635 INFO {MainThread} [main] (add_fcb) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:70} Flow Control Block added successfully with ID: 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:45.635 INFO {MainThread} [main] (log_requests) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:50} Response status: 200 for POST http://127.0.0.1:9500/fcb/add
2025-10-14 22:26:48.108 INFO {ThreadPoolExecutor-1_0} [_client] (_send_single_request) {D:\Project\V1\FlowKit\.conda\Lib\site-packages\httpx\_client.py:1025} HTTP Request: POST http://127.0.0.1:8500/nodes/add-node "HTTP/1.1 200 OK"
2025-10-14 22:26:48.109 INFO {ThreadPoolExecutor-1_0} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:63} Response from runner received for node 'start': {'node_name': 'start', 'runner_id': '7ccbb49a-87a2-4873-b1a8-d48c4aee3f29', 'code_base64': 'ZnJvbSBmbG93a2l0Lm5vZGUgaW1wb3J0IE5vZGUKZnJvbSBmbG93a2l0LmxvZyBpbXBvcnQgTG9nZ2VyCgpub2RlID0gTm9kZSgpCmxvZ2dlciA9IExvZ2dlcihub2RlKQoKYXN5bmMgZGVmIG1haW4oKToKICAgICMgbm9kZXMsIG91dHB1dCwgbWVzc2FnZQogICAgaW5wdXRzID0gbm9kZS5nZXRfaW5wdXRzKCkKICAgIHJldHVybiBbIm5vZGUxIl0sIHsiYSI6MSwgImIiOjJ9LCAicnVuIHN1Y2Nlc3NmdWxseSIKCm5vZGUucmVnaXN0ZXJfbWFpbihtYWluKQpub2RlLnJ1bigpCg==', 'status': 'DONE', 'inputs': {}, 'logs': [], 'outputs': {'nodes': ['node1'], 'outputs': {'a': 1, 'b': 2}, 'status': 'DONE', 'message': 'run successfully'}}
2025-10-14 22:26:48.109 INFO {ThreadPoolExecutor-1_0} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:67} Node 'start' execution completed successfully [runner_id=7ccbb49a-87a2-4873-b1a8-d48c4aee3f29]
2025-10-14 22:26:48.109 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (_run_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:60} Node 'start' executed with status 'success' in flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:48.109 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (_run_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:61} Node 'start' outputs: {'a': 1, 'b': 2}
2025-10-14 22:26:48.109 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (exec_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:76} Processing exec_hook for node 'start' in flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:48.109 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (exec_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:82} Queued node 'node1' with inputs: {'a': 1, 'b': 2}
2025-10-14 22:26:48.109 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (exec_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:92} Setting pointer to node 'node1' with inputs: {'a': 1, 'b': 2}
2025-10-14 22:26:48.110 INFO {ThreadPoolExecutor-1_0} [flow] (set_pointer) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow.py:18} Pointer set to node 'node1' with input: {'a': 1, 'b': 2}
2025-10-14 22:26:48.110 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (exec_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:95} Saving state for flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:48.111 INFO {ThreadPoolExecutor-1_0} [flow] (to_dict) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow.py:37} Serialized flow to dict with 2 nodes
2025-10-14 22:26:48.111 ERROR {ThreadPoolExecutor-1_0} [fcb_queue] (save_state_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:84} \u274c Error saving flow 670dbfc1-653a-4f18-98d5-842df98f3eda state: Task <Task pending name='Task-8' coro=<FlowControlBlockQueue.save_state_hook() running at D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:75> cb=[_run_until_complete_cb() at D:\Project\V1\FlowKit\.conda\Lib\asyncio\base_events.py:181]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at D:\Project\V1\FlowKit\.conda\Lib\asyncio\futures.py:393]> attached to a different loop
Traceback (most recent call last):
  File "D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py", line 75, in save_state_hook
    await self.__collection.update_one(
    ...<3 lines>...
    )
RuntimeError: Task <Task pending name='Task-8' coro=<FlowControlBlockQueue.save_state_hook() running at D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:75> cb=[_run_until_complete_cb() at D:\Project\V1\FlowKit\.conda\Lib\asyncio\base_events.py:181]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at D:\Project\V1\FlowKit\.conda\Lib\asyncio\futures.py:393]> attached to a different loop
2025-10-14 22:26:48.113 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (exec_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:98} Continuing execution of flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:48.114 INFO {ThreadPoolExecutor-1_0} [flow_control_block] (exec) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:72} Submitting next node execution for flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:48.114 INFO {ThreadPoolExecutor-1_1} [flow] (get_curr_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow.py:24} Getting current node: node1
2025-10-14 22:26:48.115 INFO {ThreadPoolExecutor-1_1} [flow] (get_curr_inp) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow.py:28} Getting current input data: {'a': 1, 'b': 2}
2025-10-14 22:26:48.115 INFO {ThreadPoolExecutor-1_1} [flow_control_block] (_run_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:57} Executing node 'node1' in flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:48.115 INFO {ThreadPoolExecutor-1_1} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:55} Executing node 'node1' [runner_id=4b7dedd2-57f9-4e03-a75f-7df89f4f317c] with inputs: {'a': 1, 'b': 2}
2025-10-14 22:26:48.115 INFO {ThreadPoolExecutor-1_1} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:58} Sending POST to http://127.0.0.1:8500/nodes/add-node with payload keys: ['node_name', 'code', 'inputs', 'runner_id']
2025-10-14 22:26:50.973 INFO {ThreadPoolExecutor-1_1} [_client] (_send_single_request) {D:\Project\V1\FlowKit\.conda\Lib\site-packages\httpx\_client.py:1025} HTTP Request: POST http://127.0.0.1:8500/nodes/add-node "HTTP/1.1 200 OK"
2025-10-14 22:26:50.974 INFO {ThreadPoolExecutor-1_1} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:63} Response from runner received for node 'node1': {'node_name': 'node1', 'runner_id': '4b7dedd2-57f9-4e03-a75f-7df89f4f317c', 'code_base64': 'ZnJvbSBmbG93a2l0Lm5vZGUgaW1wb3J0IE5vZGUKZnJvbSBmbG93a2l0LmxvZyBpbXBvcnQgTG9nZ2VyCgpub2RlID0gTm9kZSgpCmxvZ2dlciA9IExvZ2dlcihub2RlKQoKYXN5bmMgZGVmIG1haW4oKToKICAgICMgbm9kZXMsIG91dHB1dCwgbWVzc2FnZQogICAgaW5wdXRzID0gbm9kZS5nZXRfaW5wdXRzKCkKICAgIHJldCA9IGlucHV0c1siYSJdICsgaW5wdXRzWyJiIl0KICAgIHJldHVybiBbXSwgeyJvdXQiOiByZXR9LCAicnVuIHN1Y2Nlc3NmdWxseSIKCm5vZGUucmVnaXN0ZXJfbWFpbihtYWluKQpub2RlLnJ1bigpCg==', 'status': 'DONE', 'inputs': {'a': 1, 'b': 2}, 'logs': [], 'outputs': {'nodes': [], 'outputs': {'out': 3}, 'status': 'DONE', 'message': 'run successfully'}}
2025-10-14 22:26:50.975 INFO {ThreadPoolExecutor-1_1} [node] (run) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\node.py:67} Node 'node1' execution completed successfully [runner_id=4b7dedd2-57f9-4e03-a75f-7df89f4f317c]
2025-10-14 22:26:50.975 INFO {ThreadPoolExecutor-1_1} [flow_control_block] (_run_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:60} Node 'node1' executed with status 'success' in flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:50.975 INFO {ThreadPoolExecutor-1_1} [flow_control_block] (_run_node) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:61} Node 'node1' outputs: {'out': 3}
2025-10-14 22:26:50.975 INFO {ThreadPoolExecutor-1_1} [flow_control_block] (exec_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:76} Processing exec_hook for node 'node1' in flow 670dbfc1-653a-4f18-98d5-842df98f3eda
2025-10-14 22:26:50.975 INFO {ThreadPoolExecutor-1_1} [flow_control_block] (exec_hook) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:87} No more nodes to execute in flow 670dbfc1-653a-4f18-98d5-842df98f3eda, stopping
2025-10-14 22:26:50.975 INFO {ThreadPoolExecutor-1_1} [flow_control_block] (stop) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:35} FlowControlBlock 670dbfc1-653a-4f18-98d5-842df98f3eda stopping
2025-10-14 22:26:52.007 INFO {MainThread} [fcb_queue] (clean_up) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:143} Cleaning up all FlowControlBlocks
2025-10-14 22:26:52.007 INFO {MainThread} [flow_control_block] (stop) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb\flow_control_block.py:35} FlowControlBlock 670dbfc1-653a-4f18-98d5-842df98f3eda stopping
2025-10-14 22:26:52.008 INFO {MainThread} [fcb_queue] (clean_up) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:147} \U0001f6d1 Stopped FlowControlBlock 670dbfc1-653a-4f18-98d5-842df98f3eda during cleanup
2025-10-14 22:26:52.012 INFO {MainThread} [fcb_queue] (clean_up) {D:\Project\V1\FlowKit\src\FlowKitControlUint\controlunit\fcb_queue.py:154} \U0001f9fd Cleaned up FlowControlBlockQueue resources
2025-10-14 22:26:52.013 INFO {MainThread} [main] (lifespan) {D:\Project\V1\FlowKit\src\FlowKitControlUint\main.py:42} Cleaned up FCB_QUEUE and shutting down
